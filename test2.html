<html>
  <head>
    <style>
      .image {
        width: 300px;
        height: 200px;
        margin: 10px;
      }

      .radio {
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div id="imagesContainer"></div>
    <button id="backButton" onclick="goBack()">Back</button>
    <button id="nextButton" onclick="goNext()">Next</button>

    <script>

      const images = [...Array(100).keys()]; // Create an array of 100 image indices
      const n = images.length;
      const comparisons = [];
      images = images.sort(() => Math.random() - 0.5); // Shuffle the indices randomly
      let ratings = Array(100).fill().map(() => Array(100).fill(0)); // Create an array of 100x100 with all 0s
      let selectedImage = null; // Stores the selected image
      let currentImage = 0; // Stores the current image index
      // Initialize the list of already-rated pairs
      const ratedPairs = [];

      // Generate all possible comparisons between images
      for (let i = 0; i < n - 1; i++) {
        for (let j = i + 1; j < n; j++) {
          comparisons.push({img1: images[i], img2: images[j], rating: null});
        }
      }

      // Shuffle the comparisons array
      //   for (let i = comparisons.length - 1; i > 0; i--) {
      //     const j = Math.floor(Math.random() * (i + 1));
      //     [comparisons[i], comparisons[j]] = [comparisons[j], comparisons[i]];
      //   }

      // Select an image
      function selectImage(index) {
        selectedImage = index;
        document.querySelector("#radio1").disabled = false;
        document.querySelector("#radio2").disabled = false;
      }

      // Get the next pair of images to compare
      function nextComparison() {
        const img1 = document.getElementById('img1');
        const img2 = document.getElementById('img2');

        // Check if there are still comparisons left
        if (comparisons.length > 0) {
            const comparison = comparisons.shift();
            img1.src = comparison.img1;
            img2.src = comparison.img2;

            // Check if one of the images has already been rated
            if (comparison.rating !== null) {
              if (comparison.rating === 1 || comparison.rating === -1) {
                currentImage++;
              }
              } else {
              // Get a random unrated image to compare with the current image
                const unratedImages = getUnratedImages();
                const imgIndex = Math.floor(Math.random() * unratedImages.length);
                img2.src = unratedImages[imgIndex];
              }
        } else {
            // All comparisons have been made
            alert('All comparisons have been made!');
        }
      }

      // Get the images that have not been compared with the current image yet
      function getUnratedImages() {
        const unratedImages = [];
        for (let i = 0; i < n; i++) {
            let isRated = false;
            for (let j = 0; j < comparisons.length; j++) {
            if ((comparisons[j].img1 === images[currentImage] && comparisons[j].img2 === images[i]) ||
                (comparisons[j].img1 === images[i] && comparisons[j].img2 === images[currentImage])) {
                isRated = true;
                break;
            }
            }
            if (!isRated && i !== currentImage) {
            unratedImages.push(images[i]);
            }
        }
        return unratedImages;
      }

// ---

      // Rate an image
      function rateImage(selected, rated) {
        let i = images[currentImage];
        let j = images[currentImage + 1];
        if (selected === 1) {
          ratings[i][j] = rated;
        } else {
          ratings[j][i] = rated;
        }
        document.querySelector("#radio1").checked = false;
        document.querySelector("#radio2").checked = false;
        document.querySelector("#radio1").disabled = true;
        document.querySelector("#radio2").disabled = true;
        selectedImage = null;
      }


      // Get indices of unrated images
      function getUnratedImages() {
        let unrated = [];
        for (let i = 0; i < 100; i++) {
          let rated = false;
          for (let j = 0; j < 100; j++) {
            if (ratings[i][j] === 1 || ratings[j][i] === 1) {
              rated = true;
              break;
            }
          }
          if (!rated) {
            unrated.push(i);
          }
        }
        return unrated;
      }

      // Get next pair of images to compare
      function getNextPair() {
        let unrated = getUnratedImages();
        if (unrated.length <= 1) {
          return null;
        }
        let image1 = unrated[0];
        let image2 = unrated[1];
        for (let i = 0; i < 100; i++) {
          if (ratings[image1][i] === 1) {
            image2 = i;
            break;
          }
        }
        return [image1, image2];
      }

      // Select an image
      function selectImage(image) {
        deselectImage();
        selectedImage = image;
        document.querySelector(`#image${image}`).style.border = "3px solid red";
        document.querySelector(`#radio${image === 1 ? 2 : 1}`).disabled = false;
      }

      // Randomize the order of images with new label assignments
      function randomize() {
            let images = document.querySelectorAll(".image");
            for (let i = 0; i < images.length; i++) {
            let randomIndex = Math.floor(Math.random() * images.length);
            images[i].parentNode.insertBefore(images[randomIndex], images[i].nextSibling);
            }
      }


      // Deselect an image
      function deselectImage() {
        if (selectedImage === null) {
          return;
        }
        document.querySelector(`#image${selectedImage}`).style.border = "";
        document.querySelector(`#radio1`).checked = false;
        document.querySelector(`#radio2`).checked = false;
        document.querySelector(`#radio1`).disabled = true;
        document.querySelector(`#radio2`).disabled = true;
        selectedImage = null;
      }

      // Rate the selected image
      function rateImage(selectedImage, unselectedImage) {
        if (selectedImage === null) {
            return;
        }
        ratings[selectedImage][unselectedImage] = 1;
        deselectImage();
      }

      // Show the current pair of images
      function showPair(pair) {
        if (pair === null) {
          document.querySelector("#imagesContainer").innerHTML = "All images have been rated!";
          return;
        }
        let html = `
          <div>
            <img id="image1" class="image" src="image${pair[0]}.jpg" onclick="selectImage(1)">
            <input id="radio1" class="radio" type="radio" name="rating" disabled onclick="rateImage(selectedImage, 2)">
            <img id="image2" class="image" src="image${pair[1]}.jpg" onclick="selectImage(2)">
            <input id="radio2" class="radio" type="radio" name="rating" disabled onclick="rateImage(selectedImage, 1)">
          </div>
        `;
        document.querySelector("#imagesContainer").innerHTML = html;
      }

      // Go back to the previous pair of images
      function goBack() {
        currentPair--;
        showPair(getNextPair());
      }

      // Go to the next pair of images
      function goNext() {
        currentPair++;
        showPair(getNextPair());
      }

      // Show the first pair of images
      showPair(getNextPair());
    </script>
  </body>
</html>
